---
id: monitoring
title: Monitoring
description: Monitoring options of the ConfigCat Proxy.
toc_max_heading_level: 4
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

The ConfigCat Proxy provides diagnostic data including health status, metrics, and traces.

:::info
Exposed endpoints (`/status` and `/metrics`) are served on a specific port, so you can separate them from the public HTTP communication.
:::

These are the basic diagnostic-related options:

<table className="proxy-arg-table">
<thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead>
<tbody>
<tr>
<td>

<Tabs groupId="yaml-env">
<TabItem value="yaml" label="YAML" default>

```yaml
diag:
  enabled: <true|false>
```

</TabItem>
<TabItem value="env-vars" label="Environment variable">

```shell
CONFIGCAT_DIAG_ENABLED=<true|false>
```

</TabItem>
</Tabs>

</td>
<td><code>true</code></td>
<td>Turns the collection of diagnostic data on/off.</td>
</tr>

<tr>
<td>

<Tabs groupId="yaml-env">
<TabItem value="yaml" label="YAML" default>

```yaml
diag:
  port: 8051
```

</TabItem>
<TabItem value="env-vars" label="Environment variable">

```shell
CONFIGCAT_DIAG_PORT=8051
```

</TabItem>
</Tabs>

</td>
<td><code>8051</code></td>
<td>The port used by the diagnostics HTTP server.</td>
</tr>

</tbody>
</table>

## Status Endpoint {#status}

The Proxy provides status information (health check) about its components on the following endpoint:

<details open>
  <summary><span className="endpoint"><span className="http-method green">GET</span><span className="http-method gray">OPTIONS</span>/status</span></summary>

The Proxy regularly checks whether the underlying SDKs can communicate with their configured source and with the cache. This endpoint returns the actual state of these checks.

**Responses**:
<ul className="responses">
<li className="success"><span className="status">200</span>: The status returned successfully.</li>
<li className="success"><span className="status">204</span>: In response to an <code>OPTIONS</code> request.</li>
</ul>

**Example Response**:
```json
{
  "status": "healthy",
  "sdks": {
    "my_sdk": {
      "key": "****************************************hwTYg",
      "mode": "online",
      "source": {
        "type": "remote",
        "status": "healthy",
        "records": [
          "Mon, 29 May 2023 16:36:40 UTC: [ok] config fetched"
        ]
      }
    },
    "another_sdk": {
      "key": "****************************************ovVnQ",
      "mode": "offline",
      "source": {
        "type": "cache",
        "status": "healthy",
        "records": [
          "Mon, 29 May 2023 16:36:40 UTC: [ok] reload from cache succeeded",
          "Mon, 29 May 2023 16:36:45 UTC: [ok] config from cache not modified"
        ]
      }
    }
  },
  "cache": {
    "status": "healthy",
    "records": [
      "Mon, 29 May 2023 16:36:40 UTC: [ok] cache read succeeded",
      "Mon, 29 May 2023 16:36:40 UTC: [ok] cache write succeeded",
      "Mon, 29 May 2023 16:36:40 UTC: [ok] cache read succeeded",
      "Mon, 29 May 2023 16:36:45 UTC: [ok] cache read succeeded"
    ]
  }
}
```

**Details**:

If everything is operational, each `status` node shows the value `healthy`. If a component encounters a failure, it'll put an error to its `records` collection. 
If a component's last two records are errors, its `status` will switch to `degraded`. 
If a component becomes operational again it'll put an `[ok]` to the `records` and will switch back to `healthy`. 

If an SDK couldn't initialize itself neither from an external cache nor from the ConfigCat CDN, its status will be `down`. It means, this SDK is not able to accept evaluation requests because it doesn't have a valid _config JSON_ to work with.

If an SDK was able to initialize from its configured source, but its last two attempts to refresh has been failed (either from cache or from the ConfigCat CDN), it will become `degraded` because each refresh attempt will put an error to its `records` collection. 
This means, it's still able to evaluate feature flags, but it might work on a stale _config JSON_.

The root `status` is `healthy` if all of the SDKs are `healthy`. If any of the SDKs become `degraded` or `down`, the root will also switch to `degraded` (or `down` if each SDK is `down`).

</details>

You can control whether metrics collection should be enabled with the following configuration option:

<table className="proxy-arg-table">
<thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead>
<tbody>

<tr>
<td>

<Tabs groupId="yaml-env">
<TabItem value="yaml" label="YAML" default>

```yaml
diag:
  status:
    enabled: <true|false>
```

</TabItem>
<TabItem value="env-vars" label="Environment variable">

```shell
CONFIGCAT_DIAG_STATUS_ENABLED=<true|false>
```

</TabItem>
</Tabs>

</td>
<td><code>true</code></td>
<td>Turns the hosting of the <a href="#status">status endpoint</a> on the diagnostics HTTP server on/off.</td>
</tr>

</tbody>
</table>

:::info
You can enable the status endpoint on the main HTTP port (default: `8050`) with the [HTTP configuration options](overview.mdx#http).
:::

## Metrics 

If enabled, the Proxy collects various metrics. These can be either exported in Prometheus format or sent to an OTLP-compatible observability backend.

You can control whether metric collection should be enabled with the following configuration option:

<table className="proxy-arg-table">
<thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead>
<tbody>

<tr>
<td>

<Tabs groupId="yaml-env">
<TabItem value="yaml" label="YAML" default>

```yaml
diag:
  metrics:
    enabled: <true|false>
```

</TabItem>
<TabItem value="env-vars" label="Environment variable">

```shell
CONFIGCAT_DIAG_METRICS_ENABLED=<true|false>
```

</TabItem>
</Tabs>

</td>
<td><code>true</code></td>
<td>Turns metrics collection on/off.</td>
</tr>

</tbody>
</table>

### Prometheus {#prometheus-metrics}

You can set up the Proxy to export metrics about its internal state in Prometheus format. These metrics are served on the `/metrics` endpoint.

#### Custom Metrics

<table className="proxy-arg-table">
<thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead>
<tbody>

<tr>
<td>

`configcat_stream_connections`

</td>
<td>
Gauge
</td>
<td>
Number of active client connections per stream.<br/><br/>
Tags:

- `sdk`: The SDK's identifier that handles the connection.
- `type`: `sse` or `grpc`.
- `flag`: The streamed feature flag's key.

</td>
</tr>

<tr>
<td>

`configcat_stream_msg_sent_total`

</td>
<td>
Counter
</td>
<td>
Total number of all messages sent with streaming.<br/><br/>
Tags:

- `sdk`: The related SDK's identifier.
- `type`: `sse` or `grpc`.
- `flag`: The evaluated feature flag's key.

</td>
</tr>
</tbody>
</table>

The Proxy also exports metrics about the Go environment, e.g., `go_goroutines` or `go_memstats_alloc_bytes`, and process-related stats, e.g., `process_cpu_seconds_total`.

#### Integration

To integrate with Prometheus, put the following scrape config—that points to the Proxy—into your Prometheus configuration:

```yaml
scrape_configs:
  - job_name: configcat_proxy
    metrics_path: /metrics
    static_configs:
      - targets:
          - <proxy-host>:8051
```

#### Configuration Options

<table className="proxy-arg-table">
<thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead>
<tbody>

<tr>
<td>

<Tabs groupId="yaml-env">
<TabItem value="yaml" label="YAML" default>

```yaml
diag:
  metrics:
    prometheus:
      enabled: <true|false>
```

</TabItem>
<TabItem value="env-vars" label="Environment variable">

```shell
CONFIGCAT_DIAG_METRICS_PROMETHEUS_ENABLED=<true|false>
```

</TabItem>
</Tabs>

</td>
<td><code>true</code></td>
<td>Turns the Prometheus compatible `/metrics` endpoint on the diagnostics HTTP server on/off.</td>
</tr>

</tbody>
</table>

### OTLP

You can set up the Proxy to send metrics via <a href="https://opentelemetry.io/docs/specs/otlp/" target="_blank" rel="noreferrer noopener">OTLP</a> 
to a compatible collector such as <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-OTLPEndpoint.html" target="_blank" rel="noreferrer noopener">Amazon CloudWatch</a>,
<a href="https://docs.newrelic.com/docs/opentelemetry/get-started/apm-monitoring/opentelemetry-apm-intro/" target="_blank" rel="noreferrer noopener">NewRelic</a>,
<a href="https://docs.datadoghq.com/opentelemetry/setup/otlp_ingest_in_the_agent" target="_blank" rel="noreferrer noopener">DataDog</a>,
or <a href="https://docs.honeycomb.io/send-data/opentelemetry/" target="_blank" rel="noreferrer noopener">Honeycomb</a>.

#### Custom Metrics

<table className="proxy-arg-table">
<thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead>
<tbody>

<tr>
<td>

`stream.connections`

</td>
<td>
Gauge
</td>
<td>
Number of active client connections per stream.<br/><br/>
Tags:

- `sdk`: The SDK's identifier that handles the connection.
- `type`: `sse` or `grpc`.
- `flag`: The streamed feature flag's key.

</td>
</tr>

<tr>
<td>

`stream.msg.sent.total`

</td>
<td>
Counter
</td>
<td>
Total number of all messages sent with streaming.<br/><br/>
Tags:

- `sdk`: The related SDK's identifier.
- `type`: `sse` or `grpc`.
- `flag`: The evaluated feature flag's key.

</td>
</tr>
</tbody>
</table>

#### Configuration Options

<table className="proxy-arg-table">
<thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead>
<tbody>

<tr>
<td>

<Tabs groupId="yaml-env">
<TabItem value="yaml" label="YAML" default>

```yaml
diag:
  metrics:
    otlp:
      enabled: <true|false>
```

</TabItem>
<TabItem value="env-vars" label="Environment variable">

```shell
CONFIGCAT_DIAG_METRICS_OTLP_ENABLED=<true|false>
```

</TabItem>
</Tabs>

</td>
<td><code>false</code></td>
<td>Turns the sending of metrics via OTLP on/off.</td>
</tr>

<tr>
<td>

<Tabs groupId="yaml-env">
<TabItem value="yaml" label="YAML" default>

```yaml
diag:
  metrics:
    otlp:
      protocol: "<http|https|grpc>"
```

</TabItem>
<TabItem value="env-vars" label="Environment variable">

```shell
CONFIGCAT_DIAG_METRICS_OTLP_PROTOCOL="<http|https|grpc>"
```

</TabItem>
</Tabs>

</td>
<td><code>http</code></td>
<td>The protocol used to send metrics over OTLP. Possible values: <code>http</code>, <code>https</code>, and <code>grpc</code>.</td>
</tr>

<tr>
<td>

<Tabs groupId="yaml-env">
<TabItem value="yaml" label="YAML" default>

```yaml
diag:
  metrics:
    otlp:
      endpoint: "localhost:4318"
```

</TabItem>
<TabItem value="env-vars" label="Environment variable">

```shell
CONFIGCAT_DIAG_METRICS_OTLP_ENDPOINT="localhost:4318"
```

</TabItem>
</Tabs>

</td>
<td><code>localhost:4318</code></td>
<td>The OTLP collector's endpoint.</td>
</tr>

</tbody>
</table>

Additional OTLP-related options can be set by using the default <a href="https://opentelemetry.io/docs/languages/sdk-configuration/otlp-exporter/" target="_blank" rel="noreferrer noopener">OpenTelemetry environment variables</a>. 
For example, to set custom headers for each OTLP request, you can use the `OTEL_EXPORTER_OTLP_HEADERS` environment variable.

```shell
OTEL_EXPORTER_OTLP_HEADERS="Authorization=Bearer <token>"
```

## Traces

The Proxy is able to send traces via <a href="https://opentelemetry.io/docs/specs/otlp/" target="_blank" rel="noreferrer noopener">OTLP</a> 
to a compatible collector such as <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-OTLPEndpoint.html" target="_blank" rel="noreferrer noopener">Amazon CloudWatch</a>,
<a href="https://docs.newrelic.com/docs/opentelemetry/get-started/apm-monitoring/opentelemetry-apm-intro/" target="_blank" rel="noreferrer noopener">NewRelic</a>,
<a href="https://docs.datadoghq.com/opentelemetry/setup/otlp_ingest_in_the_agent" target="_blank" rel="noreferrer noopener">DataDog</a>,
or <a href="https://docs.honeycomb.io/send-data/opentelemetry/" target="_blank" rel="noreferrer noopener">Honeycomb</a>.

You can control whether trace collection should be enabled with the following configuration option:

<table className="proxy-arg-table">
<thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead>
<tbody>

<tr>
<td>

<Tabs groupId="yaml-env">
<TabItem value="yaml" label="YAML" default>

```yaml
diag:
  traces:
    enabled: <true|false>
```

</TabItem>
<TabItem value="env-vars" label="Environment variable">

```shell
CONFIGCAT_DIAG_TRACES_ENABLED=<true|false>
```

</TabItem>
</Tabs>

</td>
<td><code>false</code></td>
<td>Turns trace collection on/off.</td>
</tr>

</tbody>
</table>

#### OTLP-related Options

<table className="proxy-arg-table">
<thead><tr><th>Option</th><th>Default</th><th>Description</th></tr></thead>
<tbody>

<tr>
<td>

<Tabs groupId="yaml-env">
<TabItem value="yaml" label="YAML" default>

```yaml
diag:
  traces:
    otlp:
      enabled: <true|false>
```

</TabItem>
<TabItem value="env-vars" label="Environment variable">

```shell
CONFIGCAT_DIAG_TRACES_OTLP_ENABLED=<true|false>
```

</TabItem>
</Tabs>

</td>
<td><code>false</code></td>
<td>Turns the sending of traces via OTLP on/off.</td>
</tr>

<tr>
<td>

<Tabs groupId="yaml-env">
<TabItem value="yaml" label="YAML" default>

```yaml
diag:
  traces:
    otlp:
      protocol: "<http|https|grpc>"
```

</TabItem>
<TabItem value="env-vars" label="Environment variable">

```shell
CONFIGCAT_DIAG_TRACES_OTLP_PROTOCOL="<http|https|grpc>"
```

</TabItem>
</Tabs>

</td>
<td><code>http</code></td>
<td>The protocol used to send traces over OTLP. Possible values: <code>http</code>, <code>https</code>, and <code>grpc</code>.</td>
</tr>

<tr>
<td>

<Tabs groupId="yaml-env">
<TabItem value="yaml" label="YAML" default>

```yaml
diag:
  traces:
    otlp:
      endpoint: "localhost:4318"
```

</TabItem>
<TabItem value="env-vars" label="Environment variable">

```shell
CONFIGCAT_DIAG_TRACES_OTLP_ENDPOINT="localhost:4318"
```

</TabItem>
</Tabs>

</td>
<td><code>localhost:4318</code></td>
<td>The OTLP collector's endpoint.</td>
</tr>

</tbody>
</table>

Additional OTLP-related options can be set by using the default <a href="https://opentelemetry.io/docs/languages/sdk-configuration/otlp-exporter/" target="_blank" rel="noreferrer noopener">OpenTelemetry environment variables</a>. 
For example, to set custom headers for each OTLP request, you can use the `OTEL_EXPORTER_OTLP_HEADERS` environment variable.

```shell
OTEL_EXPORTER_OTLP_HEADERS="Authorization=Bearer <token>"
```

## OpenTelemetry Instrumentation Libraries 

Metrics and traces are also exported by the following official OpenTelemetry instrumentation libraries:
- <a href="https://github.com/open-telemetry/opentelemetry-go-contrib/tree/main/instrumentation/net/http/otelhttp" target="_blank" rel="noreferrer noopener">otelhttp</a>
- <a href="https://github.com/open-telemetry/opentelemetry-go-contrib/tree/main/instrumentation/google.golang.org/grpc/otelgrpc" target="_blank" rel="noreferrer noopener">otelgrpc</a>
- <a href="https://github.com/redis/go-redis/tree/master/extra/redisotel" target="_blank" rel="noreferrer noopener">redisotel</a>
- <a href="https://github.com/open-telemetry/opentelemetry-go-contrib/tree/main/instrumentation/go.mongodb.org/mongo-driver/v2/mongo/otelmongo" target="_blank" rel="noreferrer noopener">otelmongo</a>
- <a href="https://github.com/open-telemetry/opentelemetry-go-contrib/tree/main/instrumentation/github.com/aws/aws-sdk-go-v2/otelaws" target="_blank" rel="noreferrer noopener">otelaws</a>